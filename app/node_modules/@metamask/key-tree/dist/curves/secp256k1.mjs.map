{"version":3,"file":"secp256k1.mjs","sourceRoot":"","sources":["../../src/curves/secp256k1.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,aAAa,EAAE,wBAAwB;AACxD,OAAO,EAAE,SAAS,EAAE,gCAAgC;AAEpD,OAAO,EAAE,eAAe,EAAE,qBAAiB;AAE3C,MAAM,CAAC,MAAM,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC;AACrC,MAAM,CAAC,MAAM,IAAI,GAAG,WAAW,CAAC;AAEhC,2CAA2C;AAC3C,yHAAyH;AACzH,wHAAwH;AACxH,MAAM,CAAC,MAAM,MAAM,GAAG,aAAa,CAAC,cAAc,CAAC,CAAC;AAEpD,MAAM,CAAC,MAAM,oBAAoB,GAAG,IAAI,CAAC;AAEzC,MAAM,CAAC,MAAM,eAAe,GAAG,EAAE,CAAC;AAElC,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC,UAAsB,EAAW,EAAE;IACnE,OAAO,SAAS,CAAC,KAAK,CAAC,iBAAiB,CAAC,UAAU,CAAC,CAAC;AACvD,CAAC,CAAC;AAEF,MAAM,eAAe,GAAG,GAGP,EAAE;IACjB,IAAI,gBAAgB,GAAG,KAAK,CAAC;IAE7B,MAAM,YAAY,GAAG,CACnB,UAAsB,EACtB,UAAU,GAAG,KAAK,EACN,EAAE;QACd,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACtB,SAAS,CAAC,eAAe,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;YACjD,gBAAgB,GAAG,IAAI,CAAC;QAC1B,CAAC;QACD,OAAO,SAAS,CAAC,YAAY,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;IACxD,CAAC,CAAC;IAEF,OAAO,YAAY,CAAC;AACtB,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,YAAY,GAAG,eAAe,EAAE,CAAC;AAE9C,MAAM,CAAC,MAAM,SAAS,GAAG,CACvB,SAAqB,EACrB,KAAiB,EACL,EAAE;IACd,MAAM,CACJ,eAAe,CAAC,KAAK,EAAE,EAAE,CAAC,EAC1B,6DAA6D,CAC9D,CAAC;IAEF,MAAM,KAAK,GAAG,SAAS,CAAC,eAAe,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;IAE3D,2DAA2D;IAC3D,uEAAuE;IACvE,uIAAuI;IACvI,MAAM,QAAQ,GAAG,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,eAAe,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,CAAC;IAC5E,QAAQ,CAAC,cAAc,EAAE,CAAC;IAE1B,OAAO,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;AACpC,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC,SAAqB,EAAc,EAAE;IACrE,MAAM,KAAK,GAAG,SAAS,CAAC,eAAe,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;IAC3D,OAAO,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;AAChC,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,mBAAmB,GAAG,CAAC,SAAqB,EAAc,EAAE;IACvE,8FAA8F;IAC9F,0DAA0D;IAC1D,MAAM,KAAK,GAAG,SAAS,CAAC,eAAe,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;IAC3D,OAAO,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;AACjC,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,gBAAgB,GAAG,EAAE,CAAC;AAEnC,MAAM,CAAC,MAAM,wBAAwB,GAAG,QAAQ,CAAC;AAEjD,MAAM,CAAC,MAAM,yBAAyB,GAAG,EAAE,CAAC","sourcesContent":["import { assert, stringToBytes } from '@metamask/utils';\nimport { secp256k1 } from '@noble/curves/secp256k1';\n\nimport { isValidBytesKey } from '../utils';\n\nexport const curve = secp256k1.CURVE;\nexport const name = 'secp256k1';\n\n// Secret is defined in BIP-32 and SLIP-10:\n// https://github.com/bitcoin/bips/blob/274fa400d630ba757bec0c03b35ebe2345197108/bip-0032.mediawiki#master-key-generation\n// https://github.com/satoshilabs/slips/blob/133ea52a8e43d338b98be208907e144277e44c0e/slip-0010.md#master-key-generation\nexport const secret = stringToBytes('Bitcoin seed');\n\nexport const deriveUnhardenedKeys = true;\n\nexport const publicKeyLength = 65;\n\nexport const isValidPrivateKey = (privateKey: Uint8Array): boolean => {\n  return secp256k1.utils.isValidPrivateKey(privateKey);\n};\n\nconst getGetPublicKey = (): ((\n  privateKey: Uint8Array,\n  compressed?: boolean,\n) => Uint8Array) => {\n  let hasSetWindowSize = false;\n\n  const getPublicKey = (\n    privateKey: Uint8Array,\n    compressed = false,\n  ): Uint8Array => {\n    if (!hasSetWindowSize) {\n      secp256k1.ProjectivePoint.BASE._setWindowSize(4);\n      hasSetWindowSize = true;\n    }\n    return secp256k1.getPublicKey(privateKey, compressed);\n  };\n\n  return getPublicKey;\n};\n\nexport const getPublicKey = getGetPublicKey();\n\nexport const publicAdd = (\n  publicKey: Uint8Array,\n  tweak: Uint8Array,\n): Uint8Array => {\n  assert(\n    isValidBytesKey(tweak, 32),\n    'Invalid tweak: Tweak must be a non-zero 32-byte Uint8Array.',\n  );\n\n  const point = secp256k1.ProjectivePoint.fromHex(publicKey);\n\n  // The returned child key Ki is point(parse256(IL)) + Kpar.\n  // This multiplies the tweak with the base point of the curve (Gx, Gy).\n  // https://github.com/bitcoin/bips/blob/274fa400d630ba757bec0c03b35ebe2345197108/bip-0032.mediawiki#public-parent-key--public-child-key\n  const newPoint = point.add(secp256k1.ProjectivePoint.fromPrivateKey(tweak));\n  newPoint.assertValidity();\n\n  return newPoint.toRawBytes(false);\n};\n\nexport const compressPublicKey = (publicKey: Uint8Array): Uint8Array => {\n  const point = secp256k1.ProjectivePoint.fromHex(publicKey);\n  return point.toRawBytes(true);\n};\n\nexport const decompressPublicKey = (publicKey: Uint8Array): Uint8Array => {\n  // This calculates a point on the elliptic curve from a compressed public key. We can then use\n  // this to get the uncompressed version of the public key.\n  const point = secp256k1.ProjectivePoint.fromHex(publicKey);\n  return point.toRawBytes(false);\n};\n\nexport const privateKeyLength = 32;\n\nexport const masterNodeGenerationSpec = 'slip10';\n\nexport const compressedPublicKeyLength = 33;\n"]}